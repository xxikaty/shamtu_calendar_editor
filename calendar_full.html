<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>champagne</title>
<style>
:root{
  --bg:#EDF1F3;             /* –ë–ê–ó–û–í–´–ô –§–û–ù (–º–µ–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ HEX-–ø–æ–ª–µ) */
  --panel:#ffffff;          /* —Ü–≤–µ—Ç –∫–∞—Ä—Ç–æ—á–µ–∫ (–æ—Å—Ç–∞–≤–∏–º –±–µ–ª—ã–º –¥–ª—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞) */
  --ink:#2b2a29;
  --muted:#6f6b5f;
  --accent:#b59f6b;
  --ring:#d7c8a0;
  --radius:14px;
  --shadow:0 8px 30px rgba(0,0,0,.08);

  /* —Ü–≤–µ—Ç–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è –Ω–∞ —Ñ–æ—Ä—É–º–µ */
  --active:#E7F3FA; /* –µ—Å—Ç—å –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ */
  --done:#F1FAE7;   /* –≤—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã */
  --header:#f5f2ed; /* —Ñ–æ–Ω –∑–∞–≥–æ–ª–æ–≤–∫–∞ –≤–æ –≤—Å–ø–ª—ã–≤–∞—à–∫–µ */
  --mono: ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
  --serif: Georgia,"Times New Roman",serif;
  --sans: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
}

html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--ink);
  font-family:var(--sans); line-height:1.45;
}
.wrapper{max-width:1100px;margin:22px auto;padding:0 16px}
.header{
  display:flex; gap:12px; align-items:center; justify-content:space-between; margin-bottom:14px;
}
.brand{
  font-family:var(--serif); font-weight:700; letter-spacing:.2px; font-size:20px;
}
.tools{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
.tools input[type="text"]{
  width:130px; padding:8px 10px; border:1px solid var(--ring); border-radius:10px;
  background:#fff; color:#111; font-family:var(--mono);
}
button{
  appearance:none; cursor:pointer; border-radius:10px; border:1px solid var(--ring);
  background:linear-gradient(180deg,#fff,#f6f1e3); padding:9px 12px; font-weight:600;
}
button.primary{background:linear-gradient(180deg,#c8b07a,#b59f6b); color:#fff; border-color:#a48e5d}
button.ghost{background:#fff}
button.danger{background:#fff; color:#8b3c3c; border-color:#e1c3c3}
button:hover{transform:translateY(-1px); border-color:var(--accent)}
.status{font-size:12px;color:var(--muted)}

.card{
  background:var(--panel);
  border:1px solid var(--ring);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:16px;
}

.section-title{
  margin:8px 0 12px; font-family:var(--serif); color:#7a6a3f; font-weight:700;
}

/* ===== –ö–ê–õ–ï–ù–î–ê–†–¨ (–∂–∏–≤–æ–π –ø—Ä–æ—Å–º–æ—Ç—Ä) ===== */
.live .calendar{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:8px;                /* —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —è—á–µ–π–∫–∞–º–∏ –º–µ–Ω—å—à–µ */
  max-width:720px;        /* —É–º–µ–Ω—å—à–∞–µ—Ç –æ–±—â—É—é —à–∏—Ä–∏–Ω—É —Å–µ—Ç–∫–∏ */
  margin:0 auto;
}
.live .day {
  display:flex;
  align-items:center;
  justify-content:center;
  height:70px;             /* —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
  border-radius:10px;      /* –º—è–≥–∫–æ–µ —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ */
  border:1px solid #e3e3e3;
  text-decoration:none;
  color:#222;
  font-weight:600;
  font-size:14px;
  background:#E7F3FA;      /* –±–∞–∑–æ–≤—ã–π —Ñ–æ–Ω */
  transition: transform .15s ease, outline 0.2s ease, box-shadow 0.2s ease;
}

.live .calendar{
  display:grid;
  grid-template-columns:repeat(5,1fr);  /* 5 –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤ –≤ —Ä—è–¥ */
  gap:8px;
  max-width:720px;
  margin:0 auto;
}

.live .day:hover{
  transform:scale(1.04);
}
  
/* –°–ö–†–´–¢–¨ –ö–ù–û–ü–ö–ò –°–û–•–†–ê–ù–ò–¢–¨ –ò –ö–û–ü–ò–†–û–í–ê–¢–¨ –ö–û–î  */
  #copyBtn, #downloadBtn {
  display: none !important;
}

.popup, .no-scroll-anchor{ display:none; position:fixed; top:0; left:0; }
.popup:target{
  display:flex; align-items:center; justify-content:center; position:fixed; inset:0;
  background:rgba(0,0,0,.45); z-index:9999;
}
.popup-content{
  background:#fff; color:#222; width:min(860px,92vw); max-height:80vh; overflow:auto;
  border-radius:16px; border:1px solid var(--ring); padding:20px 22px; position:relative; box-shadow:var(--shadow);
}
.popup-content h3{ margin:0 0 10px; font-family:var(--serif) }
.popup-content .event{ padding:8px 10px; border:1px dashed #e0d6be; border-radius:10px; margin:8px 0; background:#fffdf7 }
.close{
  position:absolute; top:10px; right:12px; text-decoration:none; font-weight:700;
  color:#8d836e; background:#faf7f0; border:1px solid var(--ring); padding:6px 10px; border-radius:10px;
}

/* ===== –†–ï–î–ê–ö–¢–û–† ===== */
.editor-grid{
  display:grid;
  grid-template-columns:280px 1fr;
  gap:24px;
  align-items:start;
  border-left:4px solid transparent;
  border-right:4px solid transparent;
}
.left-side{
  border-right:1px solid #e4decf;  /* –±–µ–∂–µ–≤—ã–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å */
  padding-right:30px;              /* —á—É—Ç—å –±–æ–ª—å—à–µ –≤–æ–∑–¥—É—Ö–∞ —Å–ø—Ä–∞–≤–∞ */
  margin-right:8px;                /* –∏ –∑–∞–∑–æ—Ä –º–µ–∂–¥—É –∫–æ–ª–æ–Ω–∫–∞–º–∏ */
  box-sizing:border-box;
}

@media (max-width:980px){
  .editor-grid{ grid-template-columns:1fr; }
}

.field{ margin-bottom:12px }
label{ font-size:13px; color:var(--muted); display:block; margin-bottom:6px }
select,input[type="text"]{
  width:100%; padding:10px 12px; border:1px solid var(--ring); border-radius:10px; background:#fff; color:#111;
}
.badge{display:inline-block; font-size:12px; padding:3px 8px; border-radius:999px; background:#efe7d1; color:#6e5a2a; border:1px solid var(--ring)}
.task{ display:flex; gap:8px; align-items:center; margin-bottom:8px }
.task input[type="text"]{ flex:1 }
.task .del{ min-width:42px }
hr.sep{ border:none; height:1px; background:#e5dcc7; margin:14px 0 }

pre.code{
  background:#1c1b19; color:#e6e1cf; padding:14px; border-radius:10px; overflow:auto;
  font-family:var(--mono); font-size:12.5px; line-height:1.5; border:1px solid #2a281f;
  max-height:400px; white-space:pre-wrap; word-break:break-word; width:100%; box-sizing:border-box;
}

#codeOut {
  display: none !important;
}


#tasksBox {
  display: block;
  max-height: 240px;
  overflow-y: auto;
  padding-right: 6px;
  scroll-behavior: smooth;
  flex-shrink: 0; /* –¥–æ–±–∞–≤–ª—è–µ–º —ç—Ç—É —Å—Ç—Ä–æ–∫—É */
}

#tasksBox::-webkit-scrollbar { width: 6px; }
#tasksBox::-webkit-scrollbar-thumb {
  background: #d8ccb0;
  border-radius: 10px;
}




</style>
</head>
<body>
<div class="wrapper">

  <!-- –®–ê–ü–ö–ê —Å HEX-—Ü–≤–µ—Ç–æ–º -->
  <div class="header">
    <div class="brand">‚ô•champagne</div>
    <div class="tools">
      <span class="status" id="status"> </span>
      <input id="hexInput" type="text" placeholder="#EDF1F3" title="HEX —Ü–≤–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞"/>
      <button id="applyColorBtn" class="ghost">üé® –ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
      <button id="saveBtn" class="primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button id="copyBtn" class="ghost">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
      <button id="downloadBtn" class="ghost">‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å HTML</button>
    </div>
  </div>

  <!-- –ñ–ò–í–û–ô –ö–ê–õ–ï–ù–î–ê–†–¨ (—Ç–æ, —á—Ç–æ –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ –Ω–∞ —Ñ–æ—Ä—É–º–µ) -->
  <div class="card live" style="margin-bottom:16px;">
    <div class="section-title">–ö–∞–ª–µ–Ω–¥–∞—Ä—å </div>
    <div id="calendarView"></div>
  </div>

  <!-- –†–ï–î–ê–ö–¢–û–†: —Å–ª–µ–≤–∞ —Ñ–æ—Ä–º–∞, —Å–ø—Ä–∞–≤–∞ ‚Äî –≥–æ—Ç–æ–≤—ã–π –∫–æ–¥ -->
  <div class="card">
    <div class="section-title">–†–µ–¥–∞–∫—Ç–æ—Ä</div>

   <div class="editor-grid">
  <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
  <div class="left-side">
    <div class="field">
      <label for="daySelect">–í—ã–±–µ—Ä–∏ –¥–µ–Ω—å</label>
      <div style="display:flex;gap:8px;align-items:center">
        <select id="daySelect"></select>
        <span class="badge" id="taskCount">0 –∑–∞–¥–∞—á</span>
      </div>
    </div>

    <div class="field">
      <label for="dayTitle">–ù–∞–∑–≤–∞–Ω–∏–µ –¥–Ω—è / –¥–∞—Ç–∞ (–Ω–∞–ø—Ä. 02/11)</label>
      <input id="dayTitle" type="text" placeholder="02/11"/>
    </div>
  </div>

  <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
  <div class="right-side">
    <div class="field">
      <label>–°–æ–±—ã—Ç–∏—è –∏ –æ–ø–∏—Å–∞–Ω–∏—è (—á–µ–∫–±–æ–∫—Å ‚Äî ¬´–≤—ã–ø–æ–ª–Ω–µ–Ω–æ¬ª)</label>
      <div id="tasksBox"></div>


      <button id="addTaskBtn" class="ghost">+ –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>
    </div>
  </div>
</div>

    

      <div>
        <div class="section-title">‚ô•</div>
        <pre class="code" id="codeOut"><code>–î–∞–Ω–Ω—ã–µ –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã‚Ä¶</code></pre>
      </div>
    </div>
  </div>

</div>

<!-- Firebase (compat CDN) -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

<script>
   
  const firebaseConfig = {
    apiKey: "AIzaSyAJu-CECLKqonJxdywNFPDOuoZmvBef6Dc",
    authDomain: "forum-calendar-shamtu.firebaseapp.com",
    projectId: "forum-calendar-shamtu",
    storageBucket: "forum-calendar-shamtu.appspot.com",
    messagingSenderId: "705851712133",
    appId: "1:705851712133:web:85ae354826eba745cc7fec",
    measurementId: "G-KMBVC078HL",
  databaseURL: "https://forum-calendar-shamtu-default-rtdb.firebaseio.com"
};


/* ========== –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Firebase –≤—ã—à–µ ==================== */

let firebaseOk = false, db = null;
try {
  if (firebaseConfig && firebaseConfig.apiKey) {
    firebase.initializeApp(firebaseConfig);
    if (!firebaseConfig.databaseURL) throw new Error("–ù–µ—Ç databaseURL –≤ firebaseConfig");
    db = firebase.database();
    firebaseOk = true;
  }
} catch (e) {
  console.warn("Firebase init error:", e);
}

/* ===== –î–ê–ù–ù–´–ï ===== */
const EMPTY_DAY = () => ({ title:"", events: [] });
const DEFAULT_DATA = Array.from({length:25}, ()=>EMPTY_DAY());

let data = structuredClone(DEFAULT_DATA);
let currentDayIndex = 0;
let isLocalSave = false;


/* ===== DOM ===== */
const statusEl  = document.getElementById('status');
const codeOut   = document.getElementById('codeOut');
const calendarView = document.getElementById('calendarView');
const daySelect = document.getElementById('daySelect');
const dayTitle  = document.getElementById('dayTitle');
const tasksBox  = document.getElementById('tasksBox');
const taskCount = document.getElementById('taskCount');

function renderDaySelect(){
  daySelect.innerHTML = '';
  for (let i=0;i<25;i++){
    const title = (data[i]?.title || '').trim() || `–î–µ–Ω—å ${i+1}`;
    const opt = new Option(title, i);
    daySelect.add(opt);
  }
  daySelect.value = String(currentDayIndex);
}

renderDaySelect();

daySelect.addEventListener('change', ()=>{
  currentDayIndex = Number(daySelect.value);
  renderEditor();
});


document.getElementById('addTaskBtn').addEventListener('click', ()=>{
  data[currentDayIndex].events.push({title:"",desc:"",done:false});
  renderEditor();
  autoSave();
});

document.getElementById('saveBtn').addEventListener('click', async ()=>{
  try{
    if (!firebaseOk) throw new Error("Firebase –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
    await db.ref('/calendar').set(data);
    showStatus('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ Firebase');
flashDay(currentDayIndex);
  }catch(e){
    console.warn(e);
    showStatus('–ù–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ—Å—å –≤ Firebase');
  }
});
document.getElementById('copyBtn').addEventListener('click', ()=>{
  const text = buildForumHTML();
  navigator.clipboard.writeText(text).then(()=>showStatus('–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω'));
});
document.getElementById('downloadBtn').addEventListener('click', ()=>{
  const text = buildForumHTML();
  const blob = new Blob([text], {type:"text/html;charset=utf-8"});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = "calendar_for_forum.html";
  a.click(); URL.revokeObjectURL(a.href);
  showStatus('–§–∞–π–ª —Å–∫–∞—á–∞–Ω');
});

/* ===== –¢–ï–ú–ê (HEX —Ñ–æ–Ω –≤—Å–µ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞) ===== */
const THEME_KEY = "calendar_theme_hex";
const hexInput = document.getElementById('hexInput');
document.getElementById('applyColorBtn').addEventListener('click', ()=>{
  const val = hexInput.value.trim();
  if (/^#([0-9a-fA-F]{3}){1,2}$/.test(val)){
    document.documentElement.style.setProperty('--bg', val);
    localStorage.setItem(THEME_KEY, val);
    showStatus('–¶–≤–µ—Ç –ø—Ä–∏–º–µ–Ω—ë–Ω');
  }else{
    showStatus('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π HEX');
  }
});
(function initTheme(){
  const saved = localStorage.getItem(THEME_KEY);
  hexInput.value = saved || '#EDF1F3';
  document.documentElement.style.setProperty('--bg', saved || '#EDF1F3');
})();

/* ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–û–ï ===== */
function showStatus(msg){ statusEl.textContent = '¬∑ ' + msg; setTimeout(()=>statusEl.textContent='',4000); }
function decl(n,one,few,many){const m10=n%10,m100=n%100;return m10===1&&m100!==11?one:(m10>=2&&m10<=4&&(m100<10||m100>=20)?few:many);}
function escapeHTML(s){return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}

/* ===== –†–ï–î–ê–ö–¢–û–† ===== */
function renderEditor(){
  dayTitle.value = data[currentDayIndex].title || "";
  dayTitle.oninput = e => {
  data[currentDayIndex].title = e.target.value;
  renderDaySelect();
  daySelect.value = String(currentDayIndex);
  renderLiveCalendar();
  autoSave();
};


  tasksBox.innerHTML = '';
  // –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–Ω—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
if (!data[currentDayIndex]) {
  data[currentDayIndex] = { title: "", events: [] };
}
if (!Array.isArray(data[currentDayIndex].events)) {
  data[currentDayIndex].events = [];
}

const evs = data[currentDayIndex].events;

// –µ—Å–ª–∏ –∑–∞–¥–∞—á –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞—ë–º 4 –ø—É—Å—Ç—ã—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
if (evs.length === 0) {
  for (let n = 0; n < 4; n++) {
    evs.push({ title: "", desc: "", done: false });
  }
}



  evs.forEach((ev, idx)=>{
    const row = document.createElement('div'); row.className='task';

    const chk = document.createElement('input'); chk.type='checkbox'; chk.checked=!!ev.done;
    chk.addEventListener('change', e=>{
  ev.done = e.target.checked;
  renderLiveCalendar();   // –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞
});


const t = document.createElement('input');
t.type = 'text';
t.placeholder = '–°–æ–±—ã—Ç–∏–µ –¥–Ω—è';
t.value = ev.title || '';
t.addEventListener('input', e => {
  ev.title = e.target.value;
  autoSave(); // ‚Üê –≤–Ω—É—Ç—Ä–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
});

const d = document.createElement('input');
d.type = 'text';
d.placeholder = '–û–ø–∏—Å–∞–Ω–∏–µ –∏–ª–∏ –∑–∞–¥–∞—á–∏ –¥–Ω—è';
d.value = ev.desc || '';
d.addEventListener('input', e => {
  ev.desc = e.target.value;
  autoSave(); // ‚Üê —Ç–æ–∂–µ –≤–Ω—É—Ç—Ä–∏
});

const del = document.createElement('button');
del.className = 'del danger';
del.textContent = '‚úï';
del.title = '–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É';
del.addEventListener('click', () => {
  data[currentDayIndex].events.splice(idx, 1);
  renderEditor();
  autoSave(); // –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏ —Å—é–¥–∞, —á—Ç–æ–±—ã —Å—Ä–∞–∑—É —Å–æ—Ö—Ä–∞–Ω—è–ª–æ—Å—å –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è
});


    row.append(chk,t,d,del);
    tasksBox.appendChild(row);
  });

  const n = evs.length;
  taskCount.textContent = `${n} ${decl(n,'–∑–∞–¥–∞—á–∞','–∑–∞–¥–∞—á–∏','–∑–∞–¥–∞—á')}`;

 






 // –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º –∫–æ–¥ –∏ –≤–µ—Ä—Ö–Ω–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å
buildForumHTML();
renderLiveCalendar();
}


/* ===== –°–û–ó–î–ê–ù–ò–ï HTML –î–õ–Ø –§–û–†–£–ú–ê (—è—á–µ–π–∫–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è) ===== */
function buildForumHTML() {
  let html = '<div class="calendar">';
  for (let i = 0; i < 25; i++) {
    const title = (data[i].title && data[i].title.trim()) ? data[i].title : `–î–µ–Ω—å ${i + 1}`;
    const evs = data[i].events || [];
    const allDone = evs.length > 0 && evs.every(ev => ev.done);
    const bg = evs.length === 0 ? '#E7F3FA' : (allDone ? '#F1FAE7' : '#E7F3FA');
    html += `
     
 <a href="javascript:void(0)" 
   class="day" 
   data-day="${i}" 
   style="background:${bg};">
  ${title}
</a>

      <div id="day-${i + 1}" class="popup">
        <div class="popup-content">
          <a href="#" class="close">‚úï</a>
          <h3>–°–æ–±—ã—Ç–∏—è ${title}</h3>
          ${evs.length === 0 ? '<div class="event"><em>–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π</em></div>' : 
            evs.map(ev => `
              <div class="event">
                <strong>${escapeHTML(ev.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</strong><br/>
                ${escapeHTML(ev.desc || '')}
              </div>
            `).join('')}
        </div>
      </div>`;
  }
  html += '</div>';
  return html;
}

  /* === –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–û: —Ä–µ–Ω–¥–µ—Ä –≤–µ—Ä—Ö–Ω–µ–≥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –∏ –∫–ª–∏–∫–∏ –ø–æ –¥–Ω—è–º === */
function renderLiveCalendar(){
  calendarView.innerHTML = buildForumHTML();
  activateCalendarClicks(); // –¥–µ–ª–∞–µ–º —è—á–µ–π–∫–∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º–∏
}

/**
 * –ö–ª–∏–∫–∏ –ø–æ —è—á–µ–π–∫–∞–º –∫–∞–ª–µ–Ω–¥–∞—Ä—è:
 * - –æ–¥–∏–Ω–∞—Ä–Ω—ã–π –∫–ª–∏–∫ –æ—Å—Ç–∞—ë—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ)
 * - –¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–µ–Ω—å –≤–Ω–∏–∑—É –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –∏ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ—Ç –µ–≥–æ
 */
function activateCalendarClicks() {
  document.querySelectorAll('.day[data-day]').forEach(box => {

    // –û–±—ã—á–Ω—ã–π –∫–ª–∏–∫ ‚Äî –æ—Ç–∫—Ä—ã—Ç—å –¥–µ–Ω—å –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
    box.addEventListener('click', e => {
      openDayForEdit(box);
    });

    // –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ ‚Äî –æ—Ç–∫—Ä—ã—Ç—å –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ
    box.addEventListener('dblclick', e => {
      e.preventDefault();
      const dayId = Number(box.dataset.day) + 1;
      window.location.hash = `day-${dayId}`; // –≤—Ä—É—á–Ω—É—é –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≤—Å–ø–ª—ã–≤–∞—à–∫—É
    });
  });
}


    

// –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
function openDayForEdit(box) {
  const idx = Number(box.dataset.day);
  currentDayIndex = idx;
  daySelect.value = String(idx);
  renderEditor();

  // –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–Ω—è
  document.querySelectorAll('.day[data-day]').forEach(b => {
    b.style.outline = 'none';
    b.style.boxShadow = 'none';
  });
  box.style.outline = '2px solid #d7c8a0';
  box.style.boxShadow = '0 0 10px rgba(215,200,160,0.3)';

  // –ø–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª –∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä—É
  window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
}


/* === –í–°–ü–´–®–ö–ê –î–ù–Ø –ü–û–°–õ–ï –°–û–•–†–ê–ù–ï–ù–ò–Ø === */
function flashDay(index){
  const box = document.querySelector(`.day[data-day="${index}"]`);
  if (!box) return;
  box.style.transition = 'background 0.3s ease';
  const oldBg = box.style.background;
  box.style.background = '#f8eac5'; // —Ç—ë–ø–ª—ã–π –±–µ–∂
  setTimeout(()=>{ box.style.background = oldBg; }, 800);
}




/* ===== –ü–û–î–ü–ò–°–ö–ê –ù–ê –î–ê–ù–ù–´–ï –ò –ü–ï–†–í–ò–ß–ù–´–ô –†–ï–ù–î–ï–† ===== */
if (firebaseOk){
 db.ref('/calendar').on('value', snap=>{
  if (isLocalSave) return; // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—à–ª–∏ –ø–æ—Å–ª–µ –Ω–∞—à–µ–≥–æ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const val = snap.val();
  data = (val && Array.isArray(val) && val.length===25) ? val : structuredClone(DEFAULT_DATA);
  renderEditor();
  showStatus('–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
},
 err=>{
    console.warn(err); showStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ Firebase');
  });
} else {
  renderEditor(); // —Ö–æ—Ç—è –±—ã –ª–æ–∫–∞–ª—å–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
  showStatus('Firebase –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
}

let autoSaveTimer = null;
function autoSave() {
  if (!firebaseOk) return;

  clearTimeout(autoSaveTimer);
  autoSaveTimer = setTimeout(() => {
    isLocalSave = true; // –ø–æ–º–µ—á–∞–µ–º, —á—Ç–æ —Å–µ–π—á–∞—Å —Å–æ—Ö—Ä–∞–Ω—è–µ–º –º—ã
    db.ref('/calendar').set(data)
      .then(() => {
        showStatus('–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
        // —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É, —á—Ç–æ–±—ã —É—Å–ø–µ–ª –æ—Ç—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–≤–µ—Ç Firebase
        setTimeout(() => isLocalSave = false, 1000);
      })
      .catch(() => showStatus('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è'));
  }, 1500); // –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –≤–≤–æ–¥–æ–º –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º

}

</script>
</body>
</html>




